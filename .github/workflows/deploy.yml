name: Deploy to Google App Engine

on:
  push:
    branches:
      - main

jobs:
  build:
    name: 'Build and Deploy'
    runs-on: ubuntu-latest

    steps:
    - name: 'Checkout code'
      uses: actions/checkout@v2

    - name: 'Set up Cloud SDK'
      uses: google-github-actions/setup-gcloud@v0.2.0
      with:
        version: '290.0.1'
        service_account_key: ${{ secrets.GCP_SA_KEY }}
        project_id: 'your-gcp-project-id'

    - name: 'Set up environment variables'
      run: |
        echo "OPENAI_API_KEY=${{ secrets.OPENAI_API_KEY }}" >> $GITHUB_ENV
        echo "AZURE_SPEECH_KEY=${{ secrets.AZURE_SPEECH_KEY }}" >> $GITHUB_ENV
        echo "AZURE_SERVICE_REGION=${{ secrets.AZURE_SERVICE_REGION }}" >> $GITHUB_ENV

    - name: 'Deploy to App Engine'
      run: |
        gcloud app deploy
